import{o as e,k as a,m as t,f as o,E as s,b as i,i as r,x as l,y as n,M as c,j as d,A as u,ak as p,au as g,a7 as f,K as m,a8 as _,av as h,q as v,l as b,aw as w,w as y,P as k,p as D,s as I,t as S,S as $}from"./vendor.9947b2c4.js";import{r as x,P as E,I as M,a as T,s as C,i as z,D as A,b as U,c as V,g as O,_ as G,u as H,d as P,e as R,f as N,h as F,j as L,k as j,l as B,m as X}from"./index.4e5dee49.js";const q={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},K=[t("path",{fill:"currentColor",d:"M640 384v64H448a128 128 0 0 0-128 128v128a128 128 0 0 0 128 128h320a128 128 0 0 0 128-128V576a128 128 0 0 0-64-110.848V394.88c74.56 26.368 128 97.472 128 181.056v128a192 192 0 0 1-192 192H448a192 192 0 0 1-192-192V576a192 192 0 0 1 192-192z"},null,-1),t("path",{fill:"currentColor",d:"M384 640v-64h192a128 128 0 0 0 128-128V320a128 128 0 0 0-128-128H256a128 128 0 0 0-128 128v128a128 128 0 0 0 64 110.848v70.272A192.06 192.06 0 0 1 64 448V320a192 192 0 0 1 192-192h320a192 192 0 0 1 192 192v128a192 192 0 0 1-192 192z"},null,-1)];var Z={name:"ep-connection",render:function(t,o){return e(),a("svg",q,[...K])}};const W={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},J=[t("path",{fill:"currentColor",d:"M512 512a192 192 0 1 0 0-384a192 192 0 0 0 0 384m0 64a256 256 0 1 1 0-512a256 256 0 0 1 0 512m320 320v-96a96 96 0 0 0-96-96H288a96 96 0 0 0-96 96v96a32 32 0 1 1-64 0v-96a160 160 0 0 1 160-160h448a160 160 0 0 1 160 160v96a32 32 0 1 1-64 0"},null,-1)];var Q={name:"ep-user",render:function(t,o){return e(),a("svg",W,[...J])}};const Y=o((()=>C.getters.getUserConfigInfo)).value,ee=async()=>{await C.dispatch("USER_CONFIG_INFO_PERSIST")};const ae=async e=>{const{selectedDir:a,dirMode:t}=Y;let o=z.global.t("config_page.message_6");if(""===a){switch(t){case A.newDir:o=z.global.t("config_page.message_7"),null==e||e.focus();break;case A.repoDir:o=z.global.t("config_page.message_8")}s.warning({message:o})}else await U.push("/upload")},te=async e=>{const{token:a}=Y;if(!a)return s.error({message:z.global.t("config_page.message_1")}),void(null==e||e.focus());const t=i.service({lock:!0,text:z.global.t("config_page.loading_6")});try{const e=await(e=>x({url:"/user",method:"GET",headers:{Authorization:`Bearer ${e}`}}))(Y.token);if(!e)return t.close(),void s.error({message:z.global.t("config_page.message_2")});C.getters.getGitHubAuthorizationInfo.isAutoAuthorize||await C.dispatch("SET_GITHUB_AUTHORIZATION_INFO",{manualToken:Y.token}),await async function(e){await C.dispatch("SET_USER_CONFIG_INFO",{logined:!0,id:e.id,owner:e.login,name:e.name,email:e.email,avatarUrl:e.avatar_url})}(e);let a=!1;const i=await(r=Y.owner,l=M,x({url:`/repos/${r}/${l}`,method:"GET",noCache:!0,success422:!0,noShowErrMsg:!0}));i&&(a=!0,await C.dispatch("SET_USER_CONFIG_INFO",{repoPrivate:i.private}));const n=await(e=>x({url:"/user/repos",method:"POST",data:{name:M,description:T,private:!1},headers:{Authorization:`Bearer ${e}`},success422:!0,noShowErrMsg:!0}))(Y.token),c=o((()=>C.getters.getGitHubAuthorizationInfo)).value,{token:d,authorized:u}=c;if(await(async(e,a,t)=>{var o;if(a&&t)if(e)await C.dispatch("SET_GITHUB_AUTHORIZATION_INFO",{installed:!0});else{const e=s({customClass:"custom-message-container",duration:0,offset:20,type:"warning",message:`<div class="content-box authorization">\n                    <span class="msg">${z.global.t("authorization.msg_2")}</span>\n                    <spna class="btn-box">\n                      <span class="confirm btn">${z.global.t("authorization.btn_1")}</span>\n                    </spna>\n                  </div>`,dangerouslyUseHTMLString:!0});null==(o=document.querySelector(".custom-message-container .authorization .confirm"))||o.addEventListener("click",(()=>{e.close();let a="https://github.com/apps/picx-app/installations/select_target";Y.id&&(a="https://github.com/apps/picx-app/installations/new/permissions?target_id="+Y.id),window.location.href=a}))}})(n,u,d),!n)return t.close(),void(u&&d||s.error({message:z.global.t("config_page.message_3")}));Y.repo=M,Y.branch=V,a&&(Y.dirList=await O(Y)),Y.dirMode=A.rootDir,Y.selectedDir="/",a||await(async e=>{const{owner:a,repo:t,branch:o}=e;await x({url:`/repos/${a}/${t}/contents/README.md`,method:"PUT",data:{message:E,branch:o,content:window.btoa("\n# Welcome to use PicX\n\n[PicX](https://github.com/XPoet/picx) is a simple and powerful image hosting tool. It supports image hosting services via GitHub repository.\n\nPicX is completely open source, and you can use it for free.\n\nIf you like it, please give it a star on [GitHub](https://github.com/XPoet/picx).\n        ")},noShowErrMsg:!0})})(Y),await ee(),t.close(),s.success({message:z.global.t("config_page.message_4")}),await U.push("/upload")}catch(n){s.error({message:z.global.t("config_page.message_5")}),console.error("oneClickAutoConfig >> ",n)}var r,l};const oe={class:"page-container config-page-container"},se={class:"row-item token"},ie={class:"cell-item"},re={class:"cell-item"},le={class:"repo-descriptions-item"},ne={class:"cell-item"},ce={class:"dir-box border-box"},de={key:2,class:"dir-item"};var ue=G(r({__name:"picx-config",setup(s){const r=H(),x=l(32),E=o((()=>r.getters.getUserConfigInfo)).value,M=o((()=>r.getters.getGlobalSettings)).value,T=l(null),C=l(null),V=l("repoDirCascaderKey"),G=e=>{var a;switch(e){case A.rootDir:E.selectedDir="/";break;case A.dateDir:E.selectedDir=F("yyyyMMdd");break;case A.newDir:E.selectedDirList.length?E.selectedDir=E.selectedDirList.join("/"):E.selectedDir="xxx",null==(a=T.value)||a.focus();break;case A.repoDir:E.selectedDir="",E.selectedDirList.length&&(E.selectedDir=E.selectedDirList.join("/"));break;default:E.selectedDir="/"}ee()},q=async()=>{const e=i.service({lock:!0,text:z.global.t("config_page.loading_4")});E.dirList=await O(E),e.close(),await r.dispatch("USER_CONFIG_INFO_PERSIST")};return n((()=>{setTimeout((()=>{var e;E.token&&"1"!==U.currentRoute.value.query.focus||null==(e=C.value)||e.focus(),(()=>{const{token:e,isAutoAuthorize:a}=o((()=>r.getters.getGitHubAuthorizationInfo)).value;a&&e&&!P()&&U.currentRoute.value.query.auto&&te(C.value)})()}),100)})),(o,s)=>{const i=c,r=d,l=Q,n=u,z=p,U=g,O=Z,H=L,P=j,F=f,K=m,W=_,J=B,Y=X,ue=h;return e(),a("div",oe,[t("div",se,[v(i,{ref_key:"tokenInputRef",ref:C,modelValue:b(E).token,"onUpdate:modelValue":s[0]||(s[0]=e=>b(E).token=e),clearable:"",autofocus:!b(E).token,"show-password":"",placeholder:o.$t("config_page.input_token"),onKeydown:s[1]||(s[1]=w((e=>b(te)(C.value)),["enter"]))},null,8,["modelValue","autofocus","placeholder"]),v(r,{plain:"",type:"primary",onClick:s[2]||(s[2]=e=>b(te)(C.value))},{default:y((()=>[I(S(o.$t("config_page.one_click_config")),1)])),_:1})]),b(E).token?(e(),k(ue,{key:0,class:"row-item",column:2,border:""},{default:y((()=>[b(E).owner?(e(),k(U,{key:0},{label:y((()=>[t("div",ie,[v(n,null,{default:y((()=>[v(l)])),_:1}),I(" "+S(o.$t("username")),1)])])),default:y((()=>[v(z,{type:"primary",href:b(R)(b(E)),target:"_blank"},{default:y((()=>[I(S(b(E).owner),1)])),_:1},8,["href"])])),_:1})):D("",!0),b(E).repo?(e(),k(U,{key:1},{label:y((()=>[t("div",re,[v(n,null,{default:y((()=>[v(O)])),_:1}),I(" "+S(o.$t("repo")),1)])])),default:y((()=>[t("div",le,[v(z,{type:"primary",href:b(N)(b(E)),target:"_blank"},{default:y((()=>[I(S(b(E).repo),1)])),_:1},8,["href"]),v(H)])])),_:1})):D("",!0),b(E).repo&&b(E).branch?(e(),k(U,{key:2,span:2},{label:y((()=>[t("div",ne,[v(n,null,{default:y((()=>[v(P)])),_:1}),I(" "+S(o.$t("dir")),1)])])),default:y((()=>[t("div",ce,[v(W,{class:"dir-item",modelValue:b(E).dirMode,"onUpdate:modelValue":s[3]||(s[3]=e=>b(E).dirMode=e),onChange:G},{default:y((()=>[v(F,{label:"rootDir"},{default:y((()=>[I(S(o.$t("config_page.root_dir")),1)])),_:1}),v(K,{content:o.$t("config_page.date_dir_tip"),placement:"top",offset:0},{default:y((()=>[v(F,{label:"dateDir"},{default:y((()=>[I(S(o.$t("config_page.date_dir")),1)])),_:1})])),_:1},8,["content"]),b(E).dirList.length?(e(),k(F,{key:0,label:"repoDir"},{default:y((()=>[I(S(o.$t("config_page.repo_dir")),1)])),_:1})):D("",!0),v(K,{content:o.$t("config_page.input_new_dir"),placement:"top",offset:0},{default:y((()=>[v(F,{label:"newDir"},{default:y((()=>[I(S(o.$t("config_page.create_new_dir")),1)])),_:1})])),_:1},8,["content"])])),_:1},8,["modelValue"]),b(E).dirMode===b(A).rootDir||b(E).dirMode===b(A).dateDir?(e(),k(i,{key:0,class:"dir-item",modelValue:b(E).selectedDir,"onUpdate:modelValue":s[4]||(s[4]=e=>b(E).selectedDir=e),readonly:""},null,8,["modelValue"])):D("",!0),b(E).dirMode===b(A).newDir?(e(),k(i,{key:1,class:"dir-item",ref_key:"newDirInputRef",ref:T,modelValue:b(E).selectedDir,"onUpdate:modelValue":s[5]||(s[5]=e=>b(E).selectedDir=e),onInput:s[6]||(s[6]=e=>b(ee)()),clearable:"",placeholder:o.$t("config_page.placeholder_4")},null,8,["modelValue","placeholder"])):D("",!0),b(E).dirMode===b(A).repoDir?(e(),a("div",de,[v(J,{"el-key":V.value,"el-size":b(M).elementPlusSize,"el-clearable":!0,style:$({width:"calc(100% - "+x.value+"rem)"})},null,8,["el-key","el-size","style"]),v(n,{class:"refresh-icon",style:$({width:x.value+"rem"}),onClick:q},{default:y((()=>[v(Y)])),_:1},8,["style"])])):D("",!0)])])),_:1})):D("",!0)])),_:1})):D("",!0),b(E).token&&b(E).repo&&b(E).branch?(e(),k(r,{key:1,class:"row-item confirm-btn",plain:"",type:"primary",onClick:s[7]||(s[7]=e=>b(ae)(T.value))},{default:y((()=>[I(S(o.$t("confirm")),1)])),_:1})):D("",!0)])}}}),[["__scopeId","data-v-1651e2c6"]]);export{ue as default};
